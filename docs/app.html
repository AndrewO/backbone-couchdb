<!DOCTYPE html>  <html> <head>   <title>app.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               app.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-1">#</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-2">#</a>               </div>               <p>Fill this with your database information.
<code>ddocName</code> is the name of your couchapp project.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">Backbone</span><span class="p">.</span><span class="nx">couchConnector</span><span class="p">.</span><span class="nx">databaseName</span> <span class="o">=</span> <span class="s2">&quot;backbone-couchapp&quot;</span><span class="p">;</span>
	<span class="nx">Backbone</span><span class="p">.</span><span class="nx">couchConnector</span><span class="p">.</span><span class="nx">ddocName</span> <span class="o">=</span> <span class="s2">&quot;backbone-couchapp&quot;</span><span class="p">;</span>
	<span class="nx">Backbone</span><span class="p">.</span><span class="nx">couchConnector</span><span class="p">.</span><span class="nx">viewName</span> <span class="o">=</span> <span class="s2">&quot;byCollection&quot;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-3">#</a>               </div>               <p>If set to true, the connector will listen to the changes feed
and will provide your models with real time remote updates.
THIS FEATURE IS IN DEVELOPMENT</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">Backbone</span><span class="p">.</span><span class="nx">couchConnector</span><span class="p">.</span><span class="nx">enableChanges</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
	</pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-4">#</a>               </div>               <p>Enables Mustache.js-like templating.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">_</span><span class="p">.</span><span class="nx">templateSettings</span> <span class="o">=</span> <span class="p">{</span>
		<span class="nx">interpolate</span> <span class="o">:</span> <span class="sr">/\{\{(.+?)\}\}/g</span>
	<span class="p">};</span>
	</pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-5">#</a>               </div>               <p>The model for a comment is kinda simple.
We only need a name, a text and a date.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="kd">var</span> <span class="nx">CommentModel</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
		<span class="nx">initialize</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
			<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)){</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Anonymus&quot;</span><span class="p">});</span>
			<span class="p">}</span>
			<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)){</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">({</span><span class="s2">&quot;text&quot;</span><span class="o">:</span> <span class="s2">&quot;Nothing&quot;</span><span class="p">});</span>
			<span class="p">}</span>
			<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">)){</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">({</span><span class="s2">&quot;date&quot;</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">()});</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">});</span>
	</pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-6">#</a>               </div>               <p>Now let's define a new Collection of Comments</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="kd">var</span> <span class="nx">CommentList</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-7">#</a>               </div>               <p>The couchdb-connector is capable of mapping the url scheme
proposed by the authors of Backbone to documents in your database,
so that you don't have to change existing apps when you switch the sync-strategy</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">url</span> <span class="o">:</span> <span class="s2">&quot;/comments&quot;</span><span class="p">,</span>
		<span class="nx">model</span> <span class="o">:</span> <span class="nx">CommentModel</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-8">#</a>               </div>               <p>The comments should be ordered by date</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">comparator</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">comment</span><span class="p">){</span>
			<span class="k">return</span> <span class="p">(</span><span class="o">-</span> <span class="nx">comment</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">));</span>
		<span class="p">}</span>
	<span class="p">});</span>
	
	<span class="kd">var</span> <span class="nx">Comments</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CommentList</span><span class="p">();</span>
	</pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-9">#</a>               </div>               <p>This view is responsible for creating the Comment fields.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="kd">var</span> <span class="nx">EditView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
		<span class="nx">el</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#edit&quot;</span><span class="p">),</span>
		
		<span class="nx">events</span> <span class="o">:</span> <span class="p">{</span>
			<span class="s2">&quot;click #send&quot;</span> <span class="o">:</span> <span class="s2">&quot;onSubmit&quot;</span>
		<span class="p">},</span>
		
		<span class="nx">initialize</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
			<span class="nx">_</span><span class="p">.</span><span class="nx">bindAll</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s2">&quot;onSubmit&quot;</span><span class="p">);</span>
		<span class="p">},</span>
		</pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-10">#</a>               </div>               <p>Simply takes the vals from the input fields and 
creates a new Comment.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">onSubmit</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
			<span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#name&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
			<span class="kd">var</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#text&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
			<span class="nx">Comments</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
				<span class="s2">&quot;name&quot;</span> <span class="o">:</span> <span class="nx">name</span><span class="p">,</span>
				<span class="s2">&quot;text&quot;</span> <span class="o">:</span> <span class="nx">text</span><span class="p">,</span>
				<span class="s2">&quot;date&quot;</span> <span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">()</span>
			<span class="p">});</span>
		<span class="p">}</span>
	<span class="p">});</span>
	</pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-11">#</a>               </div>               <p>Represents an comment entry</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="kd">var</span> <span class="nx">EntryView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
		<span class="nx">tagName</span> <span class="o">:</span> <span class="s2">&quot;tr&quot;</span><span class="p">,</span>
		
		<span class="nx">template</span> <span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#entry-template&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">()),</span>
		</pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-12">#</a>               </div>               <p>Clicking the <code>X</code> leads to a deletion</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">events</span> <span class="o">:</span> <span class="p">{</span>
			<span class="s2">&quot;click .delete&quot;</span> <span class="o">:</span> <span class="s2">&quot;deleteMe&quot;</span>
		<span class="p">},</span>
		</pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-13">#</a>               </div>               <p>If there's a change in our model, rerender it</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">initialize</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
			<span class="nx">_</span><span class="p">.</span><span class="nx">bindAll</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;render&#39;</span><span class="p">,</span> <span class="s1">&#39;deleteMe&#39;</span><span class="p">);</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">);</span>
		<span class="p">},</span>
		
		<span class="nx">render</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(){</span> 
			<span class="kd">var</span> <span class="nx">content</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">();</span>
			<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="nx">content</span><span class="p">));</span>
			<span class="k">return</span> <span class="k">this</span><span class="p">;</span>
		<span class="p">},</span>
		</pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-14">#</a>               </div>               <p>Fade out the element and destroy the model</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">deleteMe</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
			<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">).</span><span class="nx">fadeOut</span><span class="p">(</span><span class="s2">&quot;fast&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span>
				<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span>
			<span class="p">});</span>
		<span class="p">}</span>
	<span class="p">});</span>
	</pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-15">#</a>               </div>               <p>The view for all comments</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="kd">var</span> <span class="nx">CommentsTable</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
		<span class="nx">el</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#comments&quot;</span><span class="p">),</span>
		
		<span class="nx">initialize</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
			<span class="nx">_</span><span class="p">.</span><span class="nx">bindAll</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;refreshed&#39;</span><span class="p">,</span> <span class="s1">&#39;addRow&#39;</span><span class="p">);</span>
			
			<span class="nx">Comments</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;refresh&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">refreshed</span><span class="p">);</span>
			<span class="nx">Comments</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">addRow</span><span class="p">);</span>
		<span class="p">},</span>
		</pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-16">#</a>               </div>               <p>Prepends an entry row </p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">addRow</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">comment</span><span class="p">){</span>
			<span class="kd">var</span> <span class="nx">view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EntryView</span><span class="p">({</span><span class="nx">model</span><span class="o">:</span> <span class="nx">comment</span><span class="p">});</span>
			<span class="kd">var</span> <span class="nx">rendered</span> <span class="o">=</span> <span class="nx">view</span><span class="p">.</span><span class="nx">render</span><span class="p">().</span><span class="nx">el</span><span class="p">;</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">prepend</span><span class="p">(</span><span class="nx">rendered</span><span class="p">);</span>
		<span class="p">},</span>
		</pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-17">#</a>               </div>               <p>Renders all comments into the table</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">refreshed</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
			<span class="k">if</span><span class="p">(</span><span class="nx">Comments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">){</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-18">#</a>               </div>               <p>reset the table</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#comments&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-19">#</a>               </div>               <p>add each element</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">Comments</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">addRow</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span>
		
	<span class="p">});</span>
	</pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-20">#</a>               </div>               <p>The App controller initializes the app by calling <code>Comments.fetch()</code></p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="kd">var</span> <span class="nx">App</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Controller</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
		<span class="nx">initialize</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
			<span class="nx">Comments</span><span class="p">.</span><span class="nx">fetch</span><span class="p">();</span>
		<span class="p">}</span>
	<span class="p">});</span>
	
	<span class="k">new</span> <span class="nx">EditView</span><span class="p">();</span>
	<span class="k">new</span> <span class="nx">CommentsTable</span><span class="p">();</span>
	<span class="k">new</span> <span class="nx">App</span><span class="p">();</span>

<span class="p">});</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 